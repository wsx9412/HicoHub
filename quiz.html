<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>구글 시트 랜덤 퀴즈</title>
    <style>
        body {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; margin: 0; background-color: #121212; font-family: 'Pretendard', sans-serif; color: white;
            position: relative; /* 홈 버튼 배치를 위해 추가 */
        }
        
        /* 홈으로 돌아가기 버튼 스타일 */
        .home-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            color: #8ab4f8;
            text-decoration: none;
            border-radius: 8px;
            font-size: 0.9rem;
            border: 1px solid #8ab4f8;
            transition: all 0.3s ease;
        }
        .home-btn:hover {
            background: #8ab4f8;
            color: #121212;
        }

        #loading { font-size: 1.2rem; color: #8ab4f8; text-align: center; }
        
        #display-area {
            display: none; width: 85%; max-width: 800px; min-height: 400px;
            background: white; color: #1a1a1a; padding: 50px; border-radius: 30px;
            text-align: center; cursor: pointer; flex-direction: column; justify-content: center; align-items: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        
        .question { font-size: 2.2rem; font-weight: bold; margin-bottom: 30px; line-height: 1.4; color: #222; }
        
        .answer { 
            font-size: 1.8rem; color: #d35400; background: #fef5e7; padding: 20px; 
            border-radius: 15px; display: none; width: 100%; box-sizing: border-box;
        }
        
        #counter { margin-top: 30px; color: #999; font-weight: bold; }
        #guide { margin-top: 15px; color: #bbb; font-size: 0.9rem; }
        /* 텍스트 선택 방지 스타일 */
        #display-area {
            user-select: none;           /* 표준 */
            -webkit-user-select: none;   /* 사파리/크롬 */
            -moz-user-select: none;      /* 파이어폭스 */
            -ms-user-select: none;       /* IE/엣지 */
            
            /* 기존 스타일들... */
            display: none; width: 85%; max-width: 800px; min-height: 400px;
            background: white; color: #1a1a1a; padding: 50px; border-radius: 30px;
            text-align: center; cursor: pointer; flex-direction: column; justify-content: center; align-items: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>

    <a href="index.html" class="home-btn">← 홈으로</a>

    <div id="loading">구글 시트에서 데이터를 불러오는 중...</div>

    <div id="display-area" onclick="handleScreenClick()">
        <div class="question" id="question-text"></div>
        <div class="answer" id="answer-text"></div>
        <div id="counter"></div>
        <div id="guide">클릭하면 정답 공개</div>
    </div>

    <script>
        // (이전 스크립트와 동일한 로직)
        const PUB_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTdSnElq5K1W3OnVVD5HIwDp-3rPnaRxwgLqFPYaER2v1-sVfMsn3sGv8gwNcxhk8YRVA9-4ayuJW4g/pub?output=csv&gid=0';
        const PROXY_URL = 'https://corsproxy.io/?' + encodeURIComponent(PUB_URL);
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzpi9oc5ClaWc8sLABzGpuDF-_ibyaIWMt-x2Q0YwHEpVo0qpl0TRESbRAEeP7hi6OO/exec';
    
        let quizData = [];
        let currentIndex = 0;
        let isShowingAnswer = false;
    
        async function fetchSheetData() {
            try {
                const response = await fetch(WEB_APP_URL + '?t=' + new Date().getTime());
                if (!response.ok) throw new Error('데이터를 불러올 수 없습니다.');
                
                const data = await response.json();
                
                // 1. 전체 데이터 가공
                let allData = data.map(item => ({
                    q: item.question,
                    a: item.answer
                })).filter(item => item.q && item.q.trim() !== "");
        
                // 2. 무작위 섞기
                allData.sort(() => Math.random() - 0.5);
        
                // 3. URL에서 개수 파라미터 가져오기
                const urlParams = new URLSearchParams(window.location.search);
                const requestedCount = parseInt(urlParams.get('count'));
        
                // 4. 입력된 개수만큼만 자르기 (값이 없거나 잘못되면 전체 출력)
                if (requestedCount && requestedCount > 0) {
                    quizData = allData.slice(0, requestedCount);
                } else {
                    quizData = allData;
                }
        
                if (quizData.length === 0) throw new Error('표시할 데이터가 없습니다.');
        
                document.getElementById('loading').style.display = 'none';
                document.getElementById('display-area').style.display = 'flex';
                showQuestion();
            } catch (error) {
                document.getElementById('loading').innerHTML = 
                    `<span style="color: #ff6b6b;">오류: ${error.message}</span>`;
            }
        }

        function showQuestion() {
            isShowingAnswer = false;
            const item = quizData[currentIndex];
            document.getElementById('question-text').innerText = item.q;
            document.getElementById('answer-text').innerText = item.a;
            document.getElementById('answer-text').style.display = 'none';
            document.getElementById('counter').innerText = (currentIndex + 1) + " / " + quizData.length;
            document.getElementById('guide').innerText = "클릭하면 정답 공개";
        }

        function handleScreenClick() {
            if (!isShowingAnswer) {
                document.getElementById('answer-text').style.display = 'block';
                document.getElementById('guide').innerText = "클릭하면 다음 문장으로";
                isShowingAnswer = true;
            } else {
                currentIndex++;
                if (currentIndex < quizData.length) {
                    showQuestion();
                } else {
                    alert("축하합니다! 모든 문제를 확인했습니다.");
                    location.href = 'index.html'; // 마지막 문제 후 자동으로 홈 이동
                }
            }
        }
        // 키보드 이벤트 리스너 추가
        document.addEventListener('keydown', function(e) {
            // 스페이스바(Space) 또는 엔터(Enter) 키 확인
            if (e.key === ' ' || e.key === 'Enter') {
                // 기본 동작 방지 (스페이스바 누를 때 페이지가 아래로 내려가는 현상 등)
                e.preventDefault();
                
                // 데이터가 로드된 상태(display-area가 보이는 상태)에서만 클릭 함수 실행
                if (document.getElementById('display-area').style.display === 'flex') {
                    handleScreenClick();
                }
            }
        });

        fetchSheetData();
    </script>
</body>
</html>
