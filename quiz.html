<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>구글 시트 랜덤 퀴즈</title>
    <style>
        body {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; margin: 0; background-color: #121212; font-family: 'Pretendard', sans-serif; color: white;
            position: relative; /* 홈 버튼 배치를 위해 추가 */
        }
        
        /* 홈으로 돌아가기 버튼 스타일 */
        .home-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            color: #8ab4f8;
            text-decoration: none;
            border-radius: 8px;
            font-size: 0.9rem;
            border: 1px solid #8ab4f8;
            transition: all 0.3s ease;
        }
        .home-btn:hover {
            background: #8ab4f8;
            color: #121212;
        }

        #loading { font-size: 1.2rem; color: #8ab4f8; text-align: center; }
        
        #display-area {
            display: none; width: 85%; max-width: 800px; min-height: 400px;
            background: white; color: #1a1a1a; padding: 50px; border-radius: 30px;
            text-align: center; cursor: pointer; flex-direction: column; justify-content: center; align-items: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        
        .question { font-size: 2.2rem; font-weight: bold; margin-bottom: 30px; line-height: 1.4; color: #222; }
        
        .answer { 
            font-size: 1.8rem; color: #d35400; background: #fef5e7; padding: 20px; 
            border-radius: 15px; display: none; width: 100%; box-sizing: border-box;
        }
        
        #counter { margin-top: 30px; color: #999; font-weight: bold; }
        #guide { margin-top: 15px; color: #bbb; font-size: 0.9rem; }
    </style>
</head>
<body>

    <a href="index.html" class="home-btn">← 홈으로</a>

    <div id="loading">구글 시트에서 데이터를 불러오는 중...</div>

    <div id="display-area" onclick="handleScreenClick()">
        <div class="question" id="question-text"></div>
        <div class="answer" id="answer-text"></div>
        <div id="counter"></div>
        <div id="guide">클릭하면 정답 공개</div>
    </div>

    <script>
        // (이전 스크립트와 동일한 로직)
        const PUB_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTdSnElq5K1W3OnVVD5HIwDp-3rPnaRxwgLqFPYaER2v1-sVfMsn3sGv8gwNcxhk8YRVA9-4ayuJW4g/pub?output=csv&gid=0';
        const PROXY_URL = 'https://corsproxy.io/?' + encodeURIComponent(PUB_URL);
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxHkBI_X_KuYLEnQ7vs6eFjBQ0voWQvj1pNVGnkb1OkuNdYUPfl6T9Ft7iDTQXGTZrU/exec';
    
        let quizData = [];
        let currentIndex = 0;
        let isShowingAnswer = false;
    
        async function fetchSheetData() {
            try {
                // 캐시를 방지하기 위해 타임스탬프 추가
                const response = await fetch(WEB_APP_URL + '?t=' + new Date().getTime());
                if (!response.ok) throw new Error('데이터를 불러올 수 없습니다.');
                
                // Apps Script의 doGet()에서 리턴한 JSON 데이터를 직접 받음
                const data = await response.json();
                
                // 데이터 형식 변환 (doGet은 {question, answer} 형태로 줌)
                quizData = data.map(item => ({
                    q: item.question,
                    a: item.answer
                })).filter(item => item.q && item.q.trim() !== "");
    
                if (quizData.length === 0) throw new Error('표시할 데이터가 없습니다.');
    
                // 무작위 섞기
                quizData.sort(() => Math.random() - 0.5);
    
                document.getElementById('loading').style.display = 'none';
                document.getElementById('display-area').style.display = 'flex';
                showQuestion();
            } catch (error) {
                document.getElementById('loading').innerHTML = 
                    `<span style="color: #ff6b6b;">오류: ${error.message}</span><br>웹 앱 URL을 확인해주세요.`;
            }
        }

        function showQuestion() {
            isShowingAnswer = false;
            const item = quizData[currentIndex];
            document.getElementById('question-text').innerText = item.q;
            document.getElementById('answer-text').innerText = item.a;
            document.getElementById('answer-text').style.display = 'none';
            document.getElementById('counter').innerText = (currentIndex + 1) + " / " + quizData.length;
            document.getElementById('guide').innerText = "클릭하면 정답 공개";
        }

        function handleScreenClick() {
            if (!isShowingAnswer) {
                document.getElementById('answer-text').style.display = 'block';
                document.getElementById('guide').innerText = "클릭하면 다음 문장으로";
                isShowingAnswer = true;
            } else {
                currentIndex++;
                if (currentIndex < quizData.length) {
                    showQuestion();
                } else {
                    alert("축하합니다! 모든 문제를 확인했습니다.");
                    location.href = 'index.html'; // 마지막 문제 후 자동으로 홈 이동
                }
            }
        }

        fetchSheetData();
    </script>
</body>
</html>
