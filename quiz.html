<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>랜덤 퀴즈 테스트</title>
    <style>
        body {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; margin: 0; background-color: #121212; font-family: 'Pretendard', sans-serif; color: white;
        }
        .home-btn {
            position: absolute; top: 20px; left: 20px; padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1); color: #8ab4f8; text-decoration: none;
            border-radius: 8px; font-size: 0.9rem; border: 1px solid #8ab4f8;
        }
        #display-area {
            display: none; width: 85%; max-width: 800px; min-height: 450px;
            background: white; color: #1a1a1a; padding: 40px; border-radius: 30px;
            text-align: center; flex-direction: column; justify-content: center; align-items: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); user-select: none;
        }
        .question { font-size: 2rem; font-weight: bold; margin-bottom: 25px; color: #222; word-break: keep-all; }
        
        /* 입력창 스타일 */
        #user-input {
            width: 100%; max-width: 500px; padding: 15px; font-size: 1.2rem;
            border: 2px solid #ddd; border-radius: 12px; margin-bottom: 20px;
            outline: none; text-align: center; transition: border 0.3s;
        }
        #user-input:focus { border-color: #3498db; }

        /* 결과 비교 영역 */
        .result-container {
            width: 100%; display: none; margin-top: 10px; text-align: left;
            background: #f8f9fa; padding: 20px; border-radius: 15px;
        }
        .result-label { font-size: 0.8rem; color: #777; margin-bottom: 5px; }
        .user-ans { font-size: 1.2rem; color: #2980b9; margin-bottom: 15px; font-weight: bold; }
        .real-ans { font-size: 1.2rem; color: #d35400; font-weight: bold; }

        #counter { margin-top: 25px; color: #999; font-weight: bold; }
        #guide { margin-top: 10px; color: #bbb; font-size: 0.8rem; }
    </style>
</head>
<body>

    <a href="index.html" class="home-btn">← 홈으로</a>
    <div id="loading">데이터를 불러오는 중...</div>

    <div id="display-area">
        <div class="question" id="question-text"></div>
        
        <input type="text" id="user-input" placeholder="정답을 입력하세요" autocomplete="off">
        
        <div class="result-container" id="result-box">
            <div class="result-label">내가 입력한 답:</div>
            <div class="user-ans" id="my-ans-text"></div>
            <hr style="border: 0; border-top: 1px solid #ddd; margin: 10px 0;">
            <div class="result-label">실제 정답:</div>
            <div class="real-ans" id="correct-ans-text"></div>
        </div>

        <div id="counter"></div>
        <div id="guide">Enter를 누르면 정답을 확인합니다.</div>
    </div>

    <script>
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzpi9oc5ClaWc8sLABzGpuDF-_ibyaIWMt-x2Q0YwHEpVo0qpl0TRESbRAEeP7hi6OO/exec';
        let quizData = [];
        let currentIndex = 0;
        let isShowingAnswer = false;

        async function fetchSheetData() {
            try {
                const response = await fetch(WEB_APP_URL + '?t=' + new Date().getTime());
                const data = await response.json();
                let allData = data.map(item => ({ q: item.question, a: item.answer })).filter(item => item.q);
                
                allData.sort(() => Math.random() - 0.5);
                const urlParams = new URLSearchParams(window.location.search);
                const count = parseInt(urlParams.get('count'));
                quizData = (count > 0) ? allData.slice(0, count) : allData;

                document.getElementById('loading').style.display = 'none';
                document.getElementById('display-area').style.display = 'flex';
                showQuestion();
            } catch (e) { document.getElementById('loading').innerText = "오류 발생"; }
        }

        function showQuestion() {
            isShowingAnswer = false;
            const item = quizData[currentIndex];
            document.getElementById('question-text').innerText = item.q;
            
            // 초기화
            const inputField = document.getElementById('user-input');
            inputField.value = "";
            inputField.style.display = "block";
            inputField.focus();
            
            document.getElementById('result-box').style.display = 'none';
            document.getElementById('counter').innerText = (currentIndex + 1) + " / " + quizData.length;
            document.getElementById('guide').innerText = "Enter를 누르면 정답을 확인합니다.";
        }

        function handleStep() {
            if (!isShowingAnswer) {
                // 정답 확인 단계
                const userAns = document.getElementById('user-input').value;
                const item = quizData[currentIndex];

                document.getElementById('my-ans-text').innerText = userAns || "(입력 안 함)";
                document.getElementById('correct-ans-text').innerText = item.a;
                
                document.getElementById('user-input').style.display = "none";
                document.getElementById('result-box').style.display = 'block';
                document.getElementById('guide').innerText = "Enter를 누르면 다음 문제로 넘어갑니다.";
                isShowingAnswer = true;
            } else {
                // 다음 문제 단계
                currentIndex++;
                if (currentIndex < quizData.length) {
                    showQuestion();
                } else {
                    alert("퀴즈가 끝났습니다!");
                    location.href = 'index.html';
                }
            }
        }

        // 키보드 엔터 이벤트
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                handleStep();
            }
        });

        // 마우스 클릭 지원 (가이드 클릭 시)
        document.getElementById('guide').onclick = handleStep;

        fetchSheetData();
    </script>
</body>
</html>
